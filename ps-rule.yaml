requires:
  # Require a minimum of PSRule for Azure v1.12.2
  PSRule.Rules.Azure: ">=1.12.2"

include:
  module:
    - PSRule.Rules.Azure

input:
  pathIgnore:
    # Exclude all files
    - '**'
    # Exclude bicepconfig.json
    - 'bicepconfig.json'
    # Include test files from modules
    - '!modules/**/*.test.bicep'
    # Include bicep parameter files for environments
    - '!**/*.bicepparam'

execution:
  # Ignore warnings for resources and objects that don't have any rules.
  unprocessedObject: Ignore

configuration:
  # Enable expansion of Azure Template files.
  AZURE_PARAMETER_FILE_EXPANSION: false
  AZURE_BICEP_PARAMS_FILE_EXPANSION: true

  # Enable expansion of Azure Bicep files.
  AZURE_BICEP_FILE_EXPANSION: true
  AZURE_BICEP_FILE_EXPANSION_TIMEOUT: 20

  # Configure the minimum AKS cluster version.
  AZURE_AKS_CLUSTER_MINIMUM_VERSION: 1.22.4

rule:
  # Enable custom rules that don't exist in the baseline
  includeLocal: true
  exclude:
    # Ignore the following rules for all resources
    - Azure.Resource.UseTags
    - Azure.Template.UseDescriptions
    - Azure.TrafficManager.Endpoints