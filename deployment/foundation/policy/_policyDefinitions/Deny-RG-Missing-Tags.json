{
    "name": "Deny-RG-Missing-Tags",
    "type": "Microsoft.Authorization/policyDefinitions",
    "apiVersion": "2021-06-01",
    "scope": null,
    "properties": {
        "displayName": "Deny if required tags are missing on resource groups",
        "policyType": "Custom",
        "mode": "All",
        "description": "Deny creation of resource groups if required tags are missing.",
        "metadata": {
          "category": "Tags",
          "createdBy": "a95f8a64-2b7e-40c3-a38d-4fc1c8a9eafd",
          "createdOn": "2023-02-28T21:38:27.3675414Z",
          "updatedBy": "a95f8a64-2b7e-40c3-a38d-4fc1c8a9eafd",
          "updatedOn": "2023-06-19T13:42:10.4844351Z"
        },
        "parameters": {
          "effect": {
            "type": "String",
            "metadata": {
              "displayName": "Effect",
              "description": "Enable or disable the execution of the policy"
            },
            "allowedValues": [
              "Audit",
              "Deny",
              "Disabled"
            ],
            "defaultValue": "Deny"
          },
          "tagName1": {
            "type": "String",
            "metadata": {
              "displayName": "Tag 1",
              "description": "Provides a cost center to attribute the bill for the resources too. Tag value: CostCenter. Example: IT"
            },
            "defaultValue": "CostCenter"
          },
          "tagName2": {
            "type": "String",
            "metadata": {
              "displayName": "Tag 2",
              "description": "Provides information on the workload deployed. Tag value: WorkloadName. Example: intranet"
            },
            "defaultValue": "WorkloadName"
          },
          "tagName3": {
            "type": "String",
            "metadata": {
              "displayName": "Tag 3",
              "description": "The Business app owner to contact. Tag value: Owner. Example: name@domain.com"
            },
            "defaultValue": "Owner"
          },
          "tagName4": {
            "type": "String",
            "metadata": {
              "displayName": "Tag 4",
              "description": "Provides date on when the resources are deployed. Tag value: CreationDate. Example: 10-08-1980"
            },
            "defaultValue": "CreationDate"
          },
          "tagName5": {
            "type": "String",
            "metadata": {
              "displayName": "Tag 5",
              "description": "Provides date on when the resources will be removed. Tag value: EndDate. Example: 25-09-1986"
            },
            "defaultValue": "EndDate"
          }
        },
        "policyRule": {
          "if": {
            "allOf": [
              {
                "field": "type",
                "equals": "Microsoft.Resources/subscriptions/resourceGroups"
              },
              {
                "anyOf": [
                  {
                    "field": "[concat('tags[',parameters('tagName1'), ']')]",
                    "exists": false
                  },
                  {
                    "field": "[concat('tags[',parameters('tagName2'), ']')]",
                    "exists": false
                  },
                  {
                    "field": "[concat('tags[',parameters('tagName3'), ']')]",
                    "exists": false
                  },
                  {
                    "field": "[concat('tags[',parameters('tagName4'), ']')]",
                    "exists": false
                  },
                  {
                    "field": "[concat('tags[',parameters('tagName5'), ']')]",
                    "exists": false
                  }
                ]
              }
            ]
          },
          "then": {
            "effect": "[parameters('effect')]"
          }
        }
    }
}
